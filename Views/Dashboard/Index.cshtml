@* Path: LedgerLink/Views/Dashboard/Index.cshtml *@
@model LedgerLink.Models.DashboardViewModel
@using System.Globalization;

@{
    ViewData["Title"] = "Admin Dashboard";
    var indiaCulture = new CultureInfo("en-IN");
}

<div class="container mt-5">
    <h2>@ViewData["Title"]</h2>
    <hr />

    @* Date Filter Form *@
    <form asp-controller="Dashboard" asp-action="Index" method="get" class="mb-4">
        <div class="row">
            <div class="col-md-4">
                <label for="startDate" class="form-label">Start Date:</label>
                <input type="date" id="startDate" name="startDate" class="form-control" value="@Model.StartDate.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-4">
                <label for="endDate" class="form-label">End Date:</label>
                <input type="date" id="endDate" name="endDate" class="form-control" value="@Model.EndDate.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Apply Filter</button>
            </div>
        </div>
    </form>

    <div class="row mb-4">
        @* Card 1: Total Outstanding Credit (Overall) *@
        <div class="col-md-4">
            <div class="card text-white bg-danger mb-3 shadow-sm">
                <div class="card-header">Total Outstanding Credit (Overall)</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalOutstandingCredit.ToString("C", indiaCulture)</h5>
                    <p class="card-text">Money pending from all customers.</p>
                </div>
            </div>
        </div>

        @* Card 2: Total Customers (Overall) *@
        <div class="col-md-4">
            <div class="card text-white bg-info mb-3 shadow-sm">
                <div class="card-header">Total Customers (Overall)</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalCustomers</h5>
                    <p class="card-text">Number of registered customers.</p>
                </div>
            </div>
        </div>

        @* Card 3: Total Products (Overall) *@
        <div class="col-md-4">
            <div class="card text-white bg-success mb-3 shadow-sm">
                <div class="card-header">Total Products (Overall)</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalProducts</h5>
                    <p class="card-text">Items available in your shop.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        @* Card 4: Total Sales in Period *@
        <div class="col-md-6">
            <div class="card text-dark bg-light mb-3 shadow-sm">
                <div class="card-header">Total Sales in Period</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalSalesInPeriod.ToString("C", indiaCulture)</h5>
                    <p class="card-text">Total value of transactions from @Model.StartDate.ToShortDateString() to @Model.EndDate.ToShortDateString().</p>
                </div>
            </div>
        </div>

        @* Card 5: Total Payments in Period *@
        <div class="col-md-6">
            <div class="card text-dark bg-light mb-3 shadow-sm">
                <div class="card-header">Total Payments in Period</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalPaymentsInPeriod.ToString("C", indiaCulture)</h5>
                    <p class="card-text">Total payments received from @Model.StartDate.ToShortDateString() to @Model.EndDate.ToShortDateString().</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        @* Section: Top Customers by Credit (Overall) *@
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h4>Top Customers by Credit (Overall)</h4>
                </div>
                <div class="card-body">
                    @if (!Model.TopCustomersByCredit.Any())
                    {
                        <p class="text-muted">No customers with outstanding credit.</p>
                    }
                    else
                    {
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var customer in Model.TopCustomersByCredit)
                                {
                                    <tr>
                                        <td>@customer.FullName</td>
                                        <td>@customer.CurrentBalance.ToString("C", indiaCulture)</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>

        @* Section: Customers with Activity in Period *@
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h4>Customers with Activity in Period</h4>
                </div>
                <div class="card-body">
                    @if (!Model.CustomersWithActivityInPeriod.Any())
                    {
                        <p class="text-muted">No customer activity in the selected period.</p>
                    }
                    else
                    {
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Phone</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var customer in Model.CustomersWithActivityInPeriod)
                                {
                                    <tr>
                                        <td>@customer.FullName</td>
                                        <td>@customer.PhoneNumber</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        @* Section: Transactions in Period *@
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4>Recent Transactions in Period</h4>
                </div>
                <div class="card-body">
                    @if (!Model.TransactionsInPeriod.Any())
                    {
                        <p class="text-muted">No transactions in the selected period.</p>
                    }
                    else
                    {
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Total</th>
                                    <th>Credit?</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var transaction in Model.TransactionsInPeriod)
                                {
                                    <tr>
                                        <td>@transaction.PurchaseDate.ToLocalTime().ToString("g")</td>
                                        <td>@transaction.Customer?.FullName</td>
                                        <td>@transaction.TotalAmount.ToString("C", indiaCulture)</td>
                                        <td>@(transaction.IsCreditTransaction ? "Yes" : "No")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>

        @* Section: Payments in Period *@
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h4>Recent Payments in Period</h4>
                </div>
                <div class="card-body">
                    @if (!Model.PaymentsInPeriod.Any())
                    {
                        <p class="text-muted">No payments in the selected period.</p>
                    }
                    else
                    {
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Mode</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var payment in Model.PaymentsInPeriod)
                                {
                                    <tr>
                                        <td>@payment.PaymentDate.ToLocalTime().ToString("g")</td>
                                        <td>@payment.Customer?.FullName</td>
                                        <td>@payment.AmountPaid.ToString("C", indiaCulture)</td>
                                        <td>@payment.PaymentMode</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>
    </div>
</div>